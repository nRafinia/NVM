@implements IDashboardComponent

<div class="card">
    <div class="card-header pb-0">
        <h5 class="m-0 me-2">CPU</h5>
    </div>

    <div class="row row-bordered g-0">
        @foreach (var cpu in _information ?? new List<CpuInformation>(0))
        {
            <div class="@_internalColSize">
                <small class="card-header m-0 me-2 pb-3">@cpu.Name</small>
                <ul class="p-1 m-3">
                    <li class="d-flex pb-1">
                        <div class="d-flex w-100 flex-wrap align-items-center justify-content-between gap-2">
                            <div class="me-2">
                                <h6 class="mb-0">Core</h6>
                                <small class="text-muted">Core count</small>
                            </div>
                            <div class="user-progress">@cpu.Cores</div>
                        </div>
                    </li>

                    <li class="d-flex pb-1">
                        <div class="d-flex w-100 flex-wrap align-items-center justify-content-between gap-2">
                            <div class="me-2">
                                <h6 class="mb-0">Logical</h6>
                                <small class="text-muted">logical Processors count</small>
                            </div>
                            <div class="user-progress">@cpu.LogicalProcessors</div>
                        </div>
                    </li>

                    <li class="pb-1 d-block">
                        <a class="me-1 mb-2 d-block collapsed" data-bs-toggle="collapse" href="#cpu-cache-1" role="button" aria-expanded="false" aria-controls="collapseExample">
                            Cache size
                        </a>
                        <div class="collapse" id="cpu-cache-1">
                            <ul class="p-0 m-0">
                                <li class="d-flex pb-1">
                                    <div class="d-flex w-100 flex-wrap align-items-center justify-content-between gap-2">
                                        <div class="me-2">
                                            <h6 class="mb-0">L1</h6>
                                            <small class="text-muted">Instruction</small>
                                        </div>
                                        <div class="user-progress">@(cpu.L1InstructionCacheSize.FormatSize())</div>
                                    </div>
                                </li>

                                <li class="d-flex pb-1">
                                    <div class="d-flex w-100 flex-wrap align-items-center justify-content-between gap-2">
                                        <div class="me-2">
                                            <small class="text-muted">Data</small>
                                        </div>
                                        <div class="user-progress">@(cpu.L1DataCacheSize.FormatSize())</div>
                                    </div>
                                </li>

                                <li class="d-flex pb-1">
                                    <div class="d-flex w-100 flex-wrap align-items-center justify-content-between gap-2">
                                        <div class="me-2">
                                            <h6 class="mb-0">L2</h6>
                                        </div>
                                        <div class="user-progress">@(cpu.L2CacheSize.FormatSize())</div>
                                    </div>
                                </li>
                                <li class="d-flex pb-1">
                                    <div class="d-flex w-100 flex-wrap align-items-center justify-content-between gap-2">
                                        <div class="me-2">
                                            <h6 class="mb-0">L3</h6>
                                        </div>
                                        <div class="user-progress">@(cpu.L3CacheSize.FormatSize())</div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </div>
        }
    </div>
</div>

@code {
    private IList<CpuInformation>? _information;
    private string _internalColSize = "col-4";
    private string _externalColSize = "col-12";

    [Parameter]
    public EventCallback GettingFinishedCallback { get; set; }
    
    public async Task GetInformation(IHardwareInformationLogic hardwareInformation)
    {
        var getInformationResponse = await hardwareInformation.GetCpu();
        if (getInformationResponse.IsFailure)
        {
            return;
        }

        _information = getInformationResponse.Value!;

        _internalColSize = _information.Count switch
        {
            1=>"col-12",
            2=>"col-12 col-lg-6",
            _=>"col-12 col-lg-4"
            };
        
        _externalColSize = _information.Count switch
        {
            1=>"col-12 col-lg-4",
            2=>"col-12 col-lg-6",
            _=>"col-12"
            };

        await InvokeAsync(StateHasChanged);
        await GettingFinishedCallback.InvokeAsync();
    }
    
    public string GetColSize => _externalColSize;

    public bool IsVisible =>
        _information is not null &&
        _information.Any();
}